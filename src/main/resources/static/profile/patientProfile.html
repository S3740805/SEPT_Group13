<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Patient profile</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
</head>
<body onload="getPatients()">

<!--<input type="text" placeholder="Type something..." id="myInput">-->
<!--<button type="button" onclick="getInputValue();">Get Value</button>-->


<div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 toppad" >
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title" id="patientUserName"></h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <!--                        <div class="col-md-3 col-lg-3 " align="center">-->
                        <!--                            <img alt="User Pic" src="https://genk.mediacdn.vn/2019/7/17/screen-shot-2019-07-17-at-65546-pm-1563364577219920569996.jpg" class="img-circle img-responsive">-->
                        <!--                        </div>-->
                        <div class=" col-md-6 col-lg-6 ">
                            <table class="table table-user-information">
                                <tbody>
                                <tr>
                                    <td>First Name:</td>
                                    <td id="FirstName"><td/>
                                </tr>
                                <tr>
                                    <td>Last Name:</td>
                                    <td id="LastName"></td>
                                </tr>
                                <tr>
                                    <td>Date of Birth:</td>
                                    <td id="DOB"></td>
                                </tr>

                                <tr>
                                <tr>
                                    <td>Gender:</td>
                                    <td id="Gender"></td>
                                </tr>
                                <tr>
                                    <td>Home Address:</td>
                                    <td id="Address"></td>
                                </tr>
                                <tr>
                                    <td>Email:</td>
                                    <td id="Email"><a href="mailto:info@support.com"></a></td>
                                </tr>
                                <td>Phone Number:</td>
                                <td id="Phone"></td>

                                </tr>

                                </tbody>
                            </table>
                        </div>
                        <div class=" col-md-4 col-lg-4 ">
                            <table class="table table-user-information">
                                <tbody>
                                <tr>
                                    <td>Allergies:</td>
                                    <td id="allergies"></td>
                                </tr>
                                <tr>
                                    <td>Blood Type:</td>
                                    <td id="bloodType"></td>
                                </tr>
                                <tr>
                                    <td>Medical History:</td>
                                    <td id="medicalHistory"></td>
                                </tr>

                                <tr>
                                <tr>
                                    <td>Health Status:</td>
                                    <td id="healthStatus"></td>
                                </tr>
                                </tbody>
                            </table>
                            <div id="save"></div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <!--                        <a data-original-title="Broadcast Message" data-toggle="tooltip" type="button" class="btn btn-sm btn-primary"><i class="glyphicon glyphicon-envelope"></i></a>-->
                        <span class="pull-right">
                            <a id="editButton" data-original-title="Edit this user" data-toggle="tooltip" type="button" class="btn btn-sm btn-warning" onclick="patientEdit()"><i class="glyphicon glyphicon-edit" ></i></a>
                            <a data-original-title="Remove this user" data-toggle="tooltip" type="button" class="btn btn-sm btn-danger" onclick="BackButton"><i class="glyphicon glyphicon-remove"></i></a>
                        </span>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>

<script>


    // function getInputValueWithId(id){
    //     getPatients(parseInt(id))
    // }
    //
    // function getInputValue(){
    //     // Selecting the input element and get its value
    //     var inputVal = document.getElementById("myInput").value;
    //
    //     getPatients(parseInt(inputVal))
    //
    //
    // }

    let currentPatient=3
    function getPatients(){
        let patientUserName = document.getElementById('patientUserName')
        let FirstName = document.getElementById('FirstName')
        let LastName = document.getElementById('LastName')
        let DOB = document.getElementById('DOB')
        let Gender = document.getElementById('Gender')
        let Address = document.getElementById('Address')
        let Email = document.getElementById('Email')
        let Phone = document.getElementById('Phone')
        let allergies =document.getElementById('allergies')
        let bloodType =document.getElementById('bloodType')
        let healthStatus=document.getElementById('healthStatus')
        let medicalHistory=document.getElementById('medicalHistory')


        patientUserName.innerHTML = ''
        fetch('http://localhost:8080/patients')
            .then(res => res.json())
            .then(json => {
                for(let i=0; i<json.length; i++){
                    let id = json[i].id
                    if ( id === currentPatient) {
                        patientUserName.innerHTML += '<div>' + json[i].username + '</div>';
                        FirstName.innerHTML += '<div>' +  json[i].fname + '</div>';
                        LastName.innerHTML += '<div>' +  json[i].lname + '</div>';
                        DOB.innerHTML ='<div>' + json[i].dob+'</div>';
                        Gender.innerHTML += '<div>' +  json[i].gender + '</div>';
                        Address.innerHTML += '<div>' +  json[i].address + '</div>';
                        Email.innerHTML += '<div>' +  json[i].email + '</div>';
                        Phone.innerHTML += '<div>' +  json[i].phone + '</div>';
                        allergies.innerHTML+= '<div>' +  json[i].allergies + '</div>';
                        bloodType.innerHTML+= '<div>' +  json[i].bloodType + '</div>';
                        healthStatus.innerHTML+= '<div>' +  json[i].healthStatus + '</div>';
                        medicalHistory.innerHTML+= '<div>' +  json[i].medicalHistory + '</div>';
                    }
                }
            })
    }
    function patientEdit() {
        // currentPatient = document.getElementById("myInput").value
        // getInputValueWithId(currentPatient)
        document.getElementById("editButton").style.display="none"
        document.getElementById("FirstName").innerHTML = `<input type="text" id="edit_fname">`
        document.getElementById("LastName").innerHTML = `<input type="text" id="edit_lname">`
        document.getElementById("DOB").innerHTML = `<input type="date" id="edit_dob">`
        document.getElementById("Gender").innerHTML =
            `<form id="edit_gender">
                 <input type="radio" name="optradio"  value="Male" >Male</input>
                 <input type="radio" name="optradio" value="Female" >Female</input>
                 <input type="radio" name="optradio" value="Other" checked>Other</input>
             </form>`
        document.getElementById("Address").innerHTML= `<input type="text" id="edit_address">`
        document.getElementById("Email").innerHTML= `<input type="text" id="edit_email">`
        document.getElementById("Phone").innerHTML= `<input type="number" id="edit_phone">`
        document.getElementById("bloodType").innerHTML=`
              <select id="edit_bloodType">
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="O">O</option>
                  <option value="AB">AB</option>
              </select>`
        document.getElementById("allergies").innerHTML= `<input type="text" id="edit_allergies">`
        document.getElementById("healthStatus").innerHTML= `<input type="text" id="edit_healthStatus">`
        document.getElementById("medicalHistory").innerHTML= `<input type="text" id="edit_medicalHistory">`
        document.getElementById("save").innerHTML+= `<button type="submit" class="btn btn-success" onclick="saveEdit()">Save</button>`

        fetch('http://localhost:8080/patients')
            .then(res => res.json())
            .then(json => {
                for(let i=0; i<json.length; i++) {
                    let id = json[i].id
                    if (id === currentPatient) {
                        document.getElementById("edit_fname").value = json[i].fname;
                        document.getElementById("edit_lname").value = json[i].lname;
                        document.getElementById("edit_dob").value = json[i].dob;
                        document.getElementById("edit_gender").value = json[i].gender;
                        document.getElementById("edit_address").value = json[i].address;
                        document.getElementById("edit_phone").value = json[i].phone;
                        document.getElementById("edit_bloodType").value = json[i].bloodType;
                        document.getElementById("edit_allergies").value= json[i].allergies;
                        document.getElementById("edit_healthStatus").value= json[i].healthStatus;
                        document.getElementById("edit_medicalHistory").value= json[i].medicalHistory;


                    }
                }
            })

    }

    function saveEdit() {
        let editFirstName = document.getElementById('edit_fname').value
        let editLastName = document.getElementById('edit_lname').value
        let editDOB = document.getElementById('edit_dob').value
        var coffee = document.forms[0];
        for (i = 0; i < coffee.length; i++) {
            if (coffee[i].checked) {
                var edit_gender = coffee[i].value;
            }
        }
        let editAddress = document.getElementById('edit_address').value
        let editEmail = document.getElementById('edit_email').value
        let editPhone = document.getElementById('edit_phone').value
        let editBloodType = document.getElementById('edit_bloodType').value
        let editAllergies = document.getElementById('edit_allergies').value
        let editHealthStatus = document.getElementById('edit_healthStatus').value
        let editMedicalHistory = document.getElementById('edit_medicalHistory').value
        fetch(`http://localhost:8080/patients/${currentPatient}`, {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "PUT",
            body: JSON.stringify({
                fname: editFirstName,
                lname: editLastName,
                address:editAddress,
                dob:editDOB,
                gender: edit_gender,
                bloodType:editBloodType,
                phone:editPhone,
                email:editEmail,
                allergies:editAllergies,
                healthStatus:editHealthStatus,
                medicalHistory:editMedicalHistory
            }),

        }).then(res => getPatients())
        location.reload()
    }





</script>